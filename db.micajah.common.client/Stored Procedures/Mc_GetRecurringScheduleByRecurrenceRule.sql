CREATE procedure [dbo].[Mc_GetRecurringScheduleByRecurrenceRule]
(
	@OrganizationId uniqueidentifier,
	@InstanceId uniqueidentifier=null,
	@RecurrenceRule nvarchar(1024)
)
as
begin
	set NOCOUNT OFF;

	select [RecurringScheduleId]
		  ,[OrganizationId]
		  ,[InstanceId]
		  ,[LocalEntityType]
		  ,[LocalEntityId]
		  ,[Name]
		  ,[StartDate]
		  ,[EndDate]
		  ,[RecurrenceRule]
		  ,[UpdatedTime]
		  ,[UpdatedBy]
		  ,[Deleted]
	from [Mc_RecurringSchedule] as RS
	where RS.OrganizationId = @OrganizationId
	and RS.Deleted = 0
	and (	@InstanceId is null 
			or RS.InstanceId is null 
			or RS.InstanceId = @InstanceId)
	and RS.[RecurrenceRule] = @RecurrenceRule;
	
END
